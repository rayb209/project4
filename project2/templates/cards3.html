<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="cards.css">
		<meta charset="utf-8" />
	</head>
	<body background="blue" >
	
	
		<canvas id="c"></canvas>
		<script>
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
		</script>
		<script>
		
// start of submission //
/*
 * Memory - classic card game
 * (C) 2012 by Gavriel Fleischer
 * http://neswork.com/javascript/js1k/2012/
 */

// define DOM selector function instead of jQuery :)
//function $(s,d){if(!d)d=b;return d.querySelectorAll(s)};

// firt I used the following 2 functions(A,R), but then I replaced them with C:
// addClass
//function A(e,c){e.classList.add(c)}
// removeClass
//function R(e,c){e.classList.remove(c)}
function C(e,c){e.className="w "+c}

//function D(d){return"width:"+d+"px;height:"+d+"px;"}

// add css3 prefixes
function P(s){return";-webkit-"+s+";-moz-"+s+";-o-"+s}

// get out a random element from an array
function R(a){return a.splice(0|a.length*Math.random(),1)[0]}

// constants we use a lot of time
A=";position:absolute";
W="width:100px;height:150px;border-radius: 10px;-webkit-box-shadow: 3px 3px 7px rgba(0,0,0,0.3);box-shadow: 3px 3px 7px rgba(0,0,0,0.3);";

//http://www.ilovecolors.com.ar/css-card-flip-webkit-transitions/
// set up styles
//$("head",document)[0].innerHTML="<style>\
   
document.querySelector("head").innerHTML="<style>\
    /* wrapper for the border of the card */\
    .w{"
        +W
        +"border:1px solid #777\
        ;text-align:center\
        ;margin:5px\
        ;font: Georgia, Times New Roman, serif\
        ;float:left"
	    +"\
    }\
    .v .b,.p .b{"
        +P("transform:rotatey(180deg);opacity: 0;")
	    +"\
		}\
    /* card */\
    .c{"
        +W
        +"font-size:80px"
        +A+"\
    }\
    /* front of the card */\
    b{\
        ;left:0\
        ;font-size:24px"
        +A+"\
    }\
    .b,.r{\
        color:red\
    }\
    /* back of the card */\
    .b{\
        background:#DFA85B"
        +P("transition:1s")
	    +"\
    }\
</style>";

    /*
     * Flip the card
     *
     * We use classes to be able to count some group of cards:
     * "p" is used for "paired" cards that stay visible forever
     * "v" is used for the 1 or 2 cards that we turned on and are currently "visible"
     */
    function F(t){
            // increase the counter and display it
//    	    f.innerHTML=++e;

            // get the visible cards
//            v=$(".v");
            v=b.querySelectorAll(".v");
            x=v[0];
            y=v[1];
            // if 2 cards are visible we need to turn them back /*v.length==2*/
    	    if(y){
                C(x,"");
                C(y,"")
    	    }
            // if one card was visible we need to compare it with the one we just turned /* v.length==1 */
    	    if(x&&!y&&x!=t&&x.innerHTML==t.innerHTML){
                // if they match we sign them as "paired"
                C(x,"p");
                C(t,"p");
                P--
            }else C(t,"v"); // otherwise we set the currently turned card to visible

            // see if we finished the whole pack
    	    if(!P){
				PlaySound('win');
    		    setTimeout(function(){alert("You WIN!!!!!")},1000);
				setTimeout(function(){location.reload()},1000);
				}
    }

    // e:counter for number of steps, i:for iterator
//    e=
//    i=0;

    P=8;
    // Fill in p array that represents the pack of cards.
    q="A234567890JQK♥♠♦♣".split("");
    p=[];
    for(c=13;c<17;c++)
        for(i=0;i<13;i++)
            p.push([c%2?' r':'',c,q[i]]);
    // Pull out a card and put it on the deck twice. Those will be the pairs.
    d=[];
    for(i=0;i<8;i++)
        d[i]=d[i+8]=R(p);

    // start to draw the screen
//    h='<div ><em id="C" >0</em> steps</div><div style="width:450px'
    h='<div style="margin-right:auto; margin-left:auto; width:450px" onclick="timer()">';
    // we need to create 16 cards
    for(i=16;i;i--){
        // take out a random element from the cards on the deck
        c=R(d);
        h+='<div class="w" onclick="F(this)"><div class="c f'
            +c[0]
            +'"><b>'
            +q[c[1]]
            +'</b>'
            +c[2]
            +'</div><div class="c b">✫</div></div>'
    }
    // add it to the DOM
    b.innerHTML=h+'</div>'
//    f=$("#C")[0]

		</script>
		</div>
		<div id="sound">
		  <p>Turns remaining <span id="displayCount">24</span></p>
        </div>
		<div id="sound"></div>
    <script type="text/javascript">
       var count=localStorage.count;
      
      var display = document.getElementById("displayCount");
	
       function PlaySound(soundobj) 
		  {
    var thissound=document.getElementById(soundobj);
    thissound.play();
	}
      function timer()
	  {
	  PlaySound('mySound');
	   if (count==0)
	  {
	  //playSound('boo-01');
	  //alert("Game Over");
	  
	  //location.reload();
	   
	  }
	  else
	  {
        count--;
		localStorage.count= count;
		display.innerHTML =count;
		if(count == 0)
		{
      PlaySound('lose');
			setTimeout(function(){alert("Game Over")},1000);
			setTimeout(function(){location.reload()},1000);
		}
		
      }
	  
	  }
	  
 function store() 
    {	
	if (localStorage.count==0)
	{
	localStorage.count=24;
	}
	else
	{
localStorage.count=count;
	}
	}
	
	
	function loader() 
    {	
display.innerHTML=localStorage.count;
}	




		
	 window.addEventListener('unload', function(event)
 {
	store(); 
});	

	 window.addEventListener('load', function(event)
 {
	loader(); 
});	     	 


    </script>
	<script>
	
	</script>
	<button>Save Game</button>
	<audio id='mySound' src='http://www.pachd.com/sfx/page_turn2.wav'/>
	<audio id='win' src='http://www.pachd.com/sfx/applause-3.wav'/>
	<audio id='lose' src='http://www.mediacollege.com/downloads/sound-effects/audience/boo-01.wav'/>
	</body>
</html>